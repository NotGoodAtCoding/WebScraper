package selenium.utils;

import java.util.List;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.*;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

/**
 * Main Superclass for generic functions of Selenium.
 * TODO: List Text from WebElements list (Might go in separate class)
 * TODO: Fully Test
 * TODO: Write Javadocs
 * @author Stefan Kraus
 *
 */
public class Automato {

	private String name;
	WebDriver driver;

	public Automato(String name){
		new Automato(name, "www.google.com");
	}
	public Automato(String name, String startingUrl){
		this.name = name;
		setupBrowser(startingUrl);
	}

	/**
	 * Helper for Constructor
	 * @param startingUrl
	 * @return
	 */
	private boolean setupBrowser(String startingUrl){
		try{
			driver = new FirefoxDriver();
			driver.get(startingUrl);
		} catch (Exception e){
			e.printStackTrace();
			return false;
		}

		driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);

		return true;
	}

	/**
	 * TESTED
	 * FIXME: Code looks bad, might want to redo how this and setupBrowser are done.
	 * @param Url
	 * @return
	 */
	public boolean navigateTo(String Url){
		try{
			driver.get(Url);
		} catch (Exception e){
			e.printStackTrace();
			return false;
		}
		return true;
	}

	// GETTERS AND SETTERS BLOCK

	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public WebDriver getDriver() {
		return driver;
	}
	public void setDriver(WebDriver driver) {
		this.driver = driver;
	}

	//END OF GETTERS AND SETTERS

	//START OF CLICK BLOCK
	/**
	 * TESTED
	 */
	public boolean clickIfExists(String locator){
		return clickIfExists(getByElement(locator));
	}
	public boolean clickIfExists(By element){
		if(exists(element)){
			try{
				getWebElement(element).click();
			} catch (Exception e){
				e.printStackTrace();
				return false;
			}
			return true;
		}
		return false;
	}

	//END OF CLICK BLOCK

	//START OF GET BY ELEMENT BLOCK

	/**
	 * TESTED
	 * @param locator
	 * @return
	 */
	public boolean exists(String locator){
		return exists(getByElement(locator));
	}

	public boolean exists(By element){
		return !getWebElement(element).equals(null);
	}

	public By getByElement(String locator){
		By element = null;
		if(locator.startsWith("id=")){
			element = By.id(locator.replaceAll("id=", "").trim().replaceAll("['\"]", ""));
		}
		else if(locator.startsWith("class=")){
			element = By.className(locator.replaceAll("class=", "").trim().replaceAll("['\"]", ""));
		}
		else if(locator.startsWith("name=")){
			element = By.name(locator.replaceAll("value=", "").trim().replaceAll("['\"]", ""));
		}
		else if(locator.startsWith("xpath=")){
			element = By.xpath(locator.replaceAll("xpath=", "").trim().replaceAll("['\"]", ""));
		}

		return element;
	}

	//END OF GET BY ELEMENT BLOCK

	//START OF GET WEBELEMENTS BLOCK

	/**
	 * Calls getByElements, then returns the 0th element if existent. 
	 * @param locator
	 * @return the WebElement if found, null if not
	 */
	public WebElement getWebElement(String locator){
		return getWebElement(getByElement(locator));
	}

	public WebElement getWebElement(By element){
		try{
			return getWebElements(element).get(0);
		} catch(Exception e){
			e.printStackTrace();
			return null;
		}
	}

	/**
	 * Handler for getting elements with a String locator.
	 * Locator should be of the form [identifier] = [value] with no spaces, special characters, and properly escaped.
	 * Supports id, class, value, and xpath identifiers.
	 * @param locator
	 * @return the WebElement if found, null if not
	 */
	public List<WebElement> getWebElements(String locator){
		return getWebElements(getByElement(locator));
	}

	public List<WebElement> getWebElements(By element){
		List<WebElement> elements = null;
		try{
			waitUntilPresent(element);
			elements = driver.findElements(element);
		} catch (Exception e){
			e.printStackTrace();
		}
		return elements;
	}

	//END OF GET WEBELEMENTS BLOCK

	//START OF KEYSEND BLOCK
	/**
	 * TODO: LIGHTLY TESTED
	 */ 
	public boolean sendKeysIfExists(String locator, String keys){
		return sendKeysIfExists(getByElement(locator), keys);
	}

	/**
	 * TODO: LIGHTLY TESTED
	 * @param element
	 * @param keys
	 * @return
	 */
	public boolean sendKeysIfExists(By element, String keys){
		return sendKeysIfExists(getWebElement(element), keys);
	}

	/**
	 * TODO: LIGHTLY TESTED
	 * @param element
	 * @param keys
	 * @return
	 */
	public boolean sendKeysIfExists(WebElement element, String keys){
		try{
			element.sendKeys(keys);
		} catch (Exception e){
			e.printStackTrace();
			return false;
		}
		return true;
	}

	//END OF KEYSEND BLOCK

	//START OF EXPLICIT WAIT BLOCK

	/**
	 * TESTED
	 * @param locator
	 * @return
	 */
	public boolean waitUntilPresent(String locator){
		return waitUntilPresent(getByElement(locator));
	}

	public boolean waitUntilPresent(By element){
		WebDriverWait wait = new WebDriverWait(driver, 10);
		wait.until(ExpectedConditions.visibilityOfElementLocated(element));
		return false;
	}

	public boolean waitUntilAllPresent(By element){
		WebDriverWait wait = new WebDriverWait(driver, 10);
		wait.until(ExpectedConditions.visibilityOfAllElementsLocatedBy(element));
		return false;

	}
	//END OF EXPLICIT WAIT BLOCK
	/**
	 * TESTED
	 * @return
	 */
	public boolean quitDriver(){
		try{
			driver.quit();
		} catch (Exception e){
			return false;
		}
		return true;
	}
}
